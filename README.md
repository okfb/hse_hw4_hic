# hse_hw4_hic,
# Код

Код в https://colab.research.google.com/drive/1OlSc1cTqTOWDwXA4EudgJxXmKU3rkude?usp=sharing.

# Выполнение

Для анализа были использованы файлы 4DNFI3EWJW3N и 4DNFI79C9HVS.

Эти файлы были загружены с [data.4dnucleome.org](https://data.4dnucleome.org/).

Визуализируем эти файлы при помощи HiGlass.

### Первый файл

![4DNFI3EWJW3N ](https://github.com/user-attachments/assets/897fbde6-be09-45f8-84d7-19048edf7ec7)


### Второй файл

![4DNFI79C9HVS ](https://github.com/user-attachments/assets/e5213b81-8b1c-435d-9ec9-b253be5ff8a3)


## Получение информации и атрибутов матрицы Hi-C с помощью cooler.info

С помощью cooler.info получим следующие данные:

| Атрибут             | Значение 1                                                           | Значение 2                                                           |
| ------------------- | -------------------------------------------------------------------- | -------------------------------------------------------------------- |
| **bin-size**        | 25000                                                                | 25000                                                                |
| **bin-type**        | fixed                                                                | fixed                                                                |
| **creation-date**   | 2024-12-06T03:22:01.510813                                           | 2025-01-06T11:18:38.237465                                           |
| **format**          | HDF5::Cooler                                                         | HDF5::Cooler                                                         |
| **format-url**      | [https://github.com/open2c/cooler](https://github.com/open2c/cooler) | [https://github.com/open2c/cooler](https://github.com/open2c/cooler) |
| **format-version**  | 3                                                                    | 3                                                                    |
| **generated-by**    | cooler-0.9.3                                                         | cooler-0.9.3                                                         |
| **genome-assembly** | unknown                                                              | unknown                                                              |
| **metadata**        | {}                                                                   | {}                                                                   |
| **nbins**           | 123541                                                               | 123541                                                               |
| **nchroms**         | 24                                                                   | 24                                                                   |
| **nnz**             | 215116865                                                            | 131881791                                                            |
| **storage-mode**    | symmetric-upper                                                      | symmetric-upper                                                      |
| **sum**             | 435653850                                                            | 569592662                                                            |


## Открытие объекта cooler как сбалансированной матрицу для внутрихромосомных контактов

```
m1 = clr1.matrix(as_pixels=True, balance=True).fetch(region)
```

![image](https://github.com/user-attachments/assets/e18a99fe-45be-4cf1-b6f8-b5959fa3a954)


```
m2 = clr2.matrix(as_pixels=True, balance=True).fetch(region)
```

![image](https://github.com/user-attachments/assets/cc374a33-4271-4c28-a00c-d57458e1593a)


## Получение таблицы с координатами и контактами, они сбалансированные или нет?

Представленные таблицы являются сбалансированными, поскольку являются нормализованными.

### Первый файл

| bin1\_id | bin2\_id | count | balanced |
| -------- | -------- | ----- | -------- |
| 41623    | 41623    | 612  | 0.145827 |
| 41623    | 41624    | 97   | 0.023956 |
| 41623    | 41625    | 26   | 0.005907 |
| 41623    | 41626    | 26   | 0.006851 |
| 41623    | 41627    | 28   | 0.007008 |
| ...      | ...      | ...   | ...      |
| 41668    | 41669    | 158    | 0.031618 |
| 41668    | 41670    | 103    | 0.020571 |
| 41669    | 41669    | 614   | 0.141613 |
| 41669    | 41670    | 190   | 0.043735 |
| 41670    | 41670    | 623   | 0.143124 |

### Второй файл

| bin1_id | bin2_id | count | balanced |
|---------|---------|-------|----------|
| 42551   | 42551   | 660   | 0.103153 |
| 42551   | 42552   | 177   | 0.028561 |
| 42551   | 42553   | 81    | 0.013905 |
| 42551   | 42554   | 74    | 0.012308 |
| 42551   | 42555   | 62    | 0.012243 |
| …       | …       | …     | …        |
| 42588   | 42589   | 180   | 0.028354 |
| 42588   | 42590   | 51    | 0.011472 |
| 42589   | 42589   | 706   | 0.105175 |
| 42589   | 42590   | 132   | 0.028080 |
| 42590   | 42590   | 450   | 0.136699 |


## Получение таблицу в командной строке командой *cooler dump*

```
! cooler dump -b -t pixels --header --join -r chr7:108,649,858-109,649,858 /content/drive/MyDrive/hiC/4DNFI4HZHGLC.mcool::resolutions/25000 | head
```

```
! cooler dump -b -t pixels --header --join -r chr7:108,649,858-109,649,858  /content/drive/MyDrive/hiC/4DNFIJPZ4ASS.mcool::resolutions/25000 | head
```

## Просмотр таблицы с бинами

### Вопрос: какие столбцы там присутствуют?

Присутвуют столбцы bin1, bin2, count.

### Первый файл

| bin1_id | bin2_id | count |
|---------|---------|-------|
| 120     | 120     | 857   |
| 120     | 121     | 161   |
| 120     | 122     | 60    |
| 120     | 123     | 51    |
| 120     | 124     | 32    |
| …       | …       | …     |
| 108985  | 108985  | 1     |
| 108989  | 108989  | 4     |
| 108990  | 108990  | 56    |
| 108990  | 108991  | 13    |
| 108991  | 108991  | 432   |


### Второй файл

| bin1_id | bin2_id | count |
|---------|---------|-------|
| 120     | 120     | 828   |
| 120     | 121     | 162   |
| 120     | 122     | 60    |
| 120     | 123     | 49    |
| 120     | 124     | 39    |
| …       | …       | …     |
| 108988  | 108988  | 1     |
| 108989  | 108989  | 6     |
| 108990  | 108990  | 58    |
| 108990  | 108991  | 12    |
| 108991  | 108991  | 372   |


## Построение кривых зависимости число контактов от расстояния для выбранной хромосомы (в логарифмических-координатах).

Был построен следующий график:

![image](https://github.com/user-attachments/assets/994fcace-c133-4760-a91e-ee860876e2bb)


### Сравнение кривых зависимости количества контактов от расстояния

- **Общий тренд**: у обеих кривых наблюдается характерное убывание количества контактов с ростом расстояния между бинами — это типичный эффект в Hi-C данных.
- **Параллельность линий**:
    - Кривые практически идентичны по наклону, особенно в среднем диапазоне расстояний.
- Это говорит о **сходной пространственной организации хроматина** в образцах.
- **Малые расстояния**:
  - В самом левом сегменте графика значения контактов совпадают почти точно.
- **Средние расстояния (~30–60 тыс. п.о.)**:
  - Кривые начинают слегка расходиться.
  - Оранжевая линия (4DNFI79C9HVS) немного выше — указывает на немного большее число контактов.
- **Большие расстояния**:
  - В правой части графика — резкое падение числа контактов у обоих образцов.

### Вывод

- Профили контактов между образцами **4DNFI3EWJW3N** и **4DNFI79C9HVS** почти совпадают, что указывает на схожую хроматинную архитектуру.
- Незначительное увеличение числа контактов в **4DNFI79C9HVS** на средних расстояниях может свидетельствовать о:
  - большей разобщённости доменов,
  - отличиях в компактизации хроматина,
  - или особенностях экспериментального протокола/клеточной линии.


## Нахождение insulation score и границы тадов для выбранного участка для обоих файлов 

### Первый файл 

| chrom | start     | end       | is_bad_bin | log2_ins_50kb | n_pix_50kb | log2_ins_75kb | n_pix_75kb | log2_ins_125kb | n_pix_125kb | b_strength_50kb | b_strength_75kb | b_strength_125kb | is_boundary_50kb | is_boundary_75kb | is_boundary_125kb |
|--------|-----------|-----------|-------------|----------------|------------|----------------|------------|------------------|--------------|------------------|------------------|--------------------|--------------------|--------------------|----------------------|
| chr1   | 900000    | 925000    | True        | NaN            | 0.0        | NaN            | 0.0        | NaN              | 0.0          | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 1000000   | 1025000   | True        | NaN            | 0.0        | NaN            | 0.0        | NaN              | 0.0          | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 74875000  | 74900000  | False       | -0.402880      | 1.0        | -0.377387      | 6.0        | -0.298422        | 22.0         | 0.516188         | 1.081113         | 0.730195           | False              | True               | True                 |
| chr1   | 74900000  | 74925000  | False       | -0.086448      | 1.0        | -0.079280      | 6.0        | 0.026499         | 22.0         | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 74950000  | 74975000  | False       | 0.479098       | 1.0        | 0.743432       | 6.0        | 0.850888         | 17.0         | NaN              | NaN              | NaN                | False              | False              | False                |


### Второй файл

| chrom | start     | end       | is_bad_bin | log2_ins_50kb | n_pix_50kb | log2_ins_75kb | n_pix_75kb | log2_ins_125kb | n_pix_125kb | b_strength_50kb | b_strength_75kb | b_strength_125kb | is_boundary_50kb | is_boundary_75kb | is_boundary_125kb |
|--------|-----------|-----------|-------------|----------------|------------|----------------|------------|------------------|--------------|------------------|------------------|--------------------|--------------------|--------------------|----------------------|
| chr1   | 900000    | 925000    | True        | NaN            | 0.0        | NaN            | 0.0        | NaN              | 0.0          | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 925000    | 950000    | True        | NaN            | 0.0        | NaN            | 0.0        | NaN              | 0.0          | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 950000    | 975000    | True        | NaN            | 0.0        | NaN            | 0.0        | NaN              | 0.0          | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 975000    | 1000000   | True        | NaN            | 0.0        | NaN            | 0.0        | NaN              | 0.0          | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 1000000   | 1025000   | True        | NaN            | 0.0        | NaN            | 0.0        | NaN              | 0.0          | NaN              | NaN              | NaN                | False              | False              | False                |
| …      | …         | …         | …           | …              | …          | …              | …          | …                | …            | …                | …                | …                  | …                  | …                  | …                    |
| chr1   | 74875000  | 74900000  | False       | -0.245087      | 1.0        | -0.294973      | 6.0        | -0.276414        | 22.0         | 0.383672         | NaN              | NaN                | False              | False              | False                |
| chr1   | 74900000  | 74925000  | False       | -0.240707      | 1.0        | -0.119401      | 6.0        | -0.035345        | 22.0         | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 74925000  | 74950000  | False       | -0.008505      | 1.0        | 0.149877       | 6.0        | 0.383983         | 22.0         | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 74950000  | 74975000  | False       | 0.470649       | 1.0        | 0.727676       | 6.0        | 0.774327         | 17.0         | NaN              | NaN              | NaN                | False              | False              | False                |
| chr1   | 74975000  | 75000000  | False       | 1.136793       | 1.0        | 0.901692       | 6.0        | 1.051527         | 12.0         | NaN              | NaN              | NaN                | False              | False              | False                |


## Сравнение результатов и построение графикок полученных кривых. Отобразите на них границы  ТАДов.

### Графики

Были построены графики, проведен сравнительный анализ и были сделаны выводы.

| Характеристика                        | Первый график (без точек)                         | Второй график (с границами)                     |
|--------------------------------------|---------------------------------------------------|-------------------------------------------------|
| **Контактная карта** (heatmap)       | Яркая, насыщенная — высокая плотность контактов.  | Чуть менее яркая, но структура всё ещё видна.   |
| **Insulation score**                 | Более шумный, флуктуирующий.                      | Сглаженный профиль без резких пиков.            |
| **Размах значений score**            | От ~–1.5 до +1.2.                                 | Более ограничен, от ~–1.2 до +1.0.              |
| **Сильные границы (оранжевые точки)**| Не отображаются.                                 | Присутствуют (чёткие пики в минус).             |
| **Слабые границы (синие точки)**     | Не отображаются.                                 | Отмечены рядом с основным сигналом.            |
| **Общее количество границ**          | Не отображается явно, но можно догадаться по форме. | Чётко видно ≈8–10 точек границ.              |
| **Регулярность TAD-ов**              | Можно различить регулярные домены.               | Домены менее выражены, структура менее чёткая.  |

---

### Выводы

- **Первый график** (без точек) визуализирует insulation-профиль, демонстрируя высокую вариативность значений и плотную контактную карту. Это указывает на:
  - Более сложную доменную архитектуру.
  - Высокое число локальных изменений — больше TAD-ов или субTAD-ов.
  - Резкие пики и провалы — признак выраженных изоляционных блоков.

- **Второй график** (с weak/strong boundaries):
  - Содержит явные точки границ TAD-ов, что упрощает интерпретацию.
  - Менее зубчатая кривая говорит о более **однородной хроматинной структуре**.
  - Меньшее число чётко выраженных TAD-ов, структура менее детализированная.

**Общий вывод**:  
Первый образец обладает **более резким insulation-профилем и большим числом TAD-ов**, тогда как второй — **сглаженный, с меньшим числом чётких границ**, что может свидетельствовать о различии в компактизации хроматина, фазе клеточного цикла или типе клеток.

#### Файл 1

![image](https://github.com/user-attachments/assets/afd4bada-35fa-4725-990f-c0062173f5da)

#### Файл 2

![image](https://github.com/user-attachments/assets/c0c76e0c-c71a-4976-835b-bdef577cae69)



#### Границы

### Границы TAD (Boundary strength distribution)

Ниже представлены гистограммы силы границ (boundary strength) для трёх окон: 50 kb, 75 kb и 125 kb. Отмечены вертикальными линиями:
- **розовая** — порог, определённый методом **Otsu**,
- **зелёная** — порог, определённый методом **Li**.

Сравнение двух образцов:

### Сравнительная таблица

| Особенность                        | Первый график (левый)                         | Второй график (правый)                         |
|-----------------------------------|-----------------------------------------------|------------------------------------------------|
| **Window 50 kb**                  | 6403 (Otsu), 9703 (Li) границ                 | 6182 (Otsu), 9464 (Li) границ                 |
| **Window 75 kb**                  | 4849 (Otsu), 6850 (Li) границ                 | 4616 (Otsu), 6659 (Li) границ                 |
| **Window 125 kb**                 | 3697 (Otsu), 5325 (Li) границ                 | 3729 (Otsu), 5193 (Li) границ                 |
| **Пик распределения силы границы**| Немного левее — максимум на меньших значениях | Немного правее — максимум на больших значениях |
| **Форма распределения**           | Плавный, широкий пик                          | Более резкий пик и быстрое падение            |
| **Количество слабых границ**      | Больше (особенно по Li)                       | Меньше, отбор более строгий                   |
| **Порог Otsu (розовая линия)**    | Чуть левее                                    | Чуть правее                                   |
| **Порог Li (зелёная линия)**      | Ниже                                           | Выше                                           |

---

#### Выводы

- **Первый график (левый)**:
  - Показывает больше слабых границ — в особенности при методе Li.
  - Распределение смещено влево — преобладают низкие значения силы.
  - Это может свидетельствовать о **более детализированной доменной структуре** с множеством мелких TAD-ов.

- **Второй график (правый)**:
  - Отображает меньшее число границ, но с большей силой.
  - Пороги выше → проходит **строже фильтрация** по значению.
  - Возможно, отражает **более стабильную и крупномасштабную организацию хроматина**.

**Общий итог**:
- Первый образец характеризуется **большим количеством слабых TAD-границ**, более фрагментированной структурой.
- Второй — **меньшим, но более чётким числом границ**, возможно, отражающим различия в биологическом контексте, типе клетки или фазе клеточного цикла.

#### Файл 1

![image](https://github.com/user-attachments/assets/505bddba-ea76-4977-99e1-f37af8fe3d15)


#### Файл 2

![image](https://github.com/user-attachments/assets/e21c87d1-076d-4012-aacf-71b7fa03577f)


## Создание 2 bed файла с границами ТАДов.В поле score добавьте силу границы.

смотрите папку tads
